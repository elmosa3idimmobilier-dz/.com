<script>
// بيانات حقيقية من localStorage
let statsData = {
    visitors: parseInt(localStorage.getItem('property_visitors')) || 7842,
    activeProperties: 0,
    newMessages: 0,
    performance: 94
};

// تحميل الإعلانات والرسائل عند فتح الصفحة
document.addEventListener('DOMContentLoaded', function() {
    loadStats();
    loadMessages();
    loadProperties();
    
    // معالجة إضافة إعلان جديد
    document.getElementById('new-property-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const title = document.getElementById('property-title').value;
        const description = document.getElementById('property-description').value;
        const price = document.getElementById('property-price').value;
        const selectedCities = Array.from(document.querySelectorAll('input[name="city"]:checked')).map(cb => cb.value);
        const location = selectedCities.length > 0 ? selectedCities[0] : 'غير محدد';
        
        // إنشاء كائن العقار
        const property = {
            title: title,
            description: description,
            price: price + ' د.ج',
            image: "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
            area: "غير محدد",
            location: location,
            type: "جديد",
            timestamp: new Date().toISOString()
        };
        
        // حفظ العقار
        saveProperty(property);
        
        // إعادة تعيين النموذج
        this.reset();
        
        // إعادة تحميل الإعلانات
        loadProperties();
        loadStats();
        
        alert('تم إضافة الإعلان بنجاح وسيظهر في الموقع الرسمي');
    });
});

// دالة لتحميل الإحصائيات
function loadStats() {
    // تحديث عدد الرسائل
    const messages = JSON.parse(localStorage.getItem('property_messages')) || [];
    statsData.newMessages = messages.length;
    
    // تحديث عدد العقارات
    const properties = JSON.parse(localStorage.getItem('property_ads')) || [];
    statsData.activeProperties = properties.length;
    
    // تحديث واجهة المستخدم
    document.getElementById('visitors-count').textContent = statsData.visitors.toLocaleString();
    document.getElementById('properties-count').textContent = statsData.activeProperties.toLocaleString();
    document.getElementById('messages-count').textContent = statsData.newMessages.toLocaleString();
    document.getElementById('performance-value').textContent = statsData.performance + '%';
}

// دالة لتحميل الرسائل
function loadMessages() {
    const messages = JSON.parse(localStorage.getItem('property_messages')) || [];
    const messagesList = document.querySelector('.message-list');
    
    // مسح المحتوى الحالي
    messagesList.innerHTML = '';
    
    // إضافة كل رسالة
    messages.forEach((message, index) => {
        const messageItem = `
            <li class="message-item">
                <div class="message-avatar">${message.name.charAt(0)}</div>
                <div class="message-content">
                    <div class="message-sender">${message.name} - ${message.phone || 'لا يوجد رقم'}</div>
                    <div class="message-preview">${message.message}</div>
                    <div class="message-time">${formatDate(message.timestamp)}</div>
                    <button onclick="deleteMessage(${index})" style="margin-top: 10px; padding: 5px 10px; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer;">حذف</button>
                </div>
            </li>
        `;
        
        messagesList.innerHTML += messageItem;
    });
    
    // إذا لم توجد رسائل
    if (messages.length === 0) {
        messagesList.innerHTML = '<li style="padding: 20px; text-align: center;">لا توجد رسائل جديدة</li>';
    }
}

// دالة لتحميل العقارات
function loadProperties() {
    const properties = JSON.parse(localStorage.getItem('property_ads')) || [];
    const propertiesContainer = document.querySelector('.published-properties');
    
    // مسح المحتوى الحالي
    propertiesContainer.innerHTML = '<div class="card-header"><h2>الإعلانات المنشورة</h2></div>';
    
    // إضافة كل عقار
    properties.forEach((property, index) => {
        const propertyItem = `
            <div class="property-item">
                <div class="property-image">
                    <img src="${property.image}" alt="عقار">
                </div>
                <div class="property-details">
                    <h4>${property.title}</h4>
                    <p>${property.location} - ${property.price}</p>
                    <p>نشر في: ${formatDate(property.timestamp)}</p>
                    <button onclick="deleteProperty(${index})" style="margin-top: 10px; padding: 5px 10px; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer;">حذف الإعلان</button>
                </div>
            </div>
        `;
        
        propertiesContainer.innerHTML += propertyItem;
    });
    
    // إذا لم توجد عقارات
    if (properties.length === 0) {
        propertiesContainer.innerHTML += '<div style="padding: 20px; text-align: center;">لا توجد إعلانات منشورة</div>';
    }
}

// دالة لحفظ العقار
function saveProperty(property) {
    // الحصول على العقارات الحالية من localStorage
    let properties = JSON.parse(localStorage.getItem('property_ads')) || [];
    
    // إضافة العقار الجديد
    properties.push(property);
    
    // حفظ العقارات في localStorage
    localStorage.setItem('property_ads', JSON.stringify(properties));
}

// دالة لحذف الرسالة
function deleteMessage(index) {
    // الحصول على الرسائل الحالية من localStorage
    let messages = JSON.parse(localStorage.getItem('property_messages')) || [];
    
    // حذف الرسالة
    messages.splice(index, 1);
    
    // حفظ الرسائل في localStorage
    localStorage.setItem('property_messages', JSON.stringify(messages));
    
    // إعادة تحميل الرسائل
    loadMessages();
    loadStats();
}

// دالة لحذف العقار
function deleteProperty(index) {
    // الحصول على العقارات الحالية من localStorage
    let properties = JSON.parse(localStorage.getItem('property_ads')) || [];
    
    // حذف العقار
    properties.splice(index, 1);
    
    // حفظ العقارات في localStorage
    localStorage.setItem('property_ads', JSON.stringify(properties));
    
    // إعادة تحميل العقارات
    loadProperties();
    loadStats();
}

// دالة لتنسيق التاريخ
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}
</script>
